<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Network protocal, TCP," />





  <link rel="alternate" href="/atom.xml" title="Mathematic Revisit" type="application/atom+xml" />






<meta name="description" content="For every instance of a kind of item, in a specific period of time, the instance itself will stay in a specific status. Take a cell phone as example, it can be in IDLE status, ALERTING status, CONNECT">
<meta name="keywords" content="Network protocal, TCP">
<meta property="og:type" content="article">
<meta property="og:title" content="TCP state transmissions">
<meta property="og:url" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/index.html">
<meta property="og:site_name" content="Mathematic Revisit">
<meta property="og:description" content="For every instance of a kind of item, in a specific period of time, the instance itself will stay in a specific status. Take a cell phone as example, it can be in IDLE status, ALERTING status, CONNECT">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState1.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState2.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState3.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState4.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState5.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState6.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState7.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState8.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState9.png">
<meta property="og:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState10.png">
<meta property="og:updated_time" content="2018-03-30T07:03:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TCP state transmissions">
<meta name="twitter:description" content="For every instance of a kind of item, in a specific period of time, the instance itself will stay in a specific status. Take a cell phone as example, it can be in IDLE status, ALERTING status, CONNECT">
<meta name="twitter:image" content="http://taotao.guru/2016-01-23-tcp-connection-status-transit/TCPState1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://taotao.guru/2016-01-23-tcp-connection-status-transit/"/>





  <title>TCP state transmissions | Mathematic Revisit</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mathematic Revisit</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Trivialities on mathematics and computer science.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://taotao.guru/2016-01-23-tcp-connection-status-transit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="toto">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mathematic Revisit">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">TCP state transmissions</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-23T23:29:55+08:00">
                2016-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network-protocal/" itemprop="url" rel="index">
                    <span itemprop="name">Network protocal</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>For every instance of a kind of item, in a specific period of time, the instance itself will stay in a specific status. Take a cell phone as example, it can be in IDLE status, ALERTING status, CONNECTED status etc. A process could be in CREATED, READY, BLOCKED, RUNNING, DEAD status. When specific events occur, the status of the item can be transfer from one to another. For a kind of items, we can talk about different kind of status from different point of view, or different dimensions. I notes the transmissions of TCP endpoints in this one.</p>
<a id="more"></a>
<h1 id="state-transmission-chart">State transmission chart</h1>
<p>People usually use a state transmission diagram to describe the state transfermations of an item. Before sketching a diagram, there are something should be clarified. We must tell explicitly the item that we need to describe, list all the states during the whole transformation and the events that triger the transfermation. I still take the celll phone as example. The phone is the object which has IDLE, SHUTDOWN, ALERTING, CONNECTED states, the events trigering the transmission are shown with arrows.</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState1.png" alt="Phone state transmission diagram"><figcaption>Phone state transmission diagram</figcaption>
</figure>
<p>#TCP endpoints state transmission TCP protocal discribe the communication from endpoint to endpoint. The tcp state tranmission diagram describe the endpoints’ state change. It actually the transmission ctronl block in the os kernel (in most conditions), from the application layer, we can treat it as the socket state transfermation. Let’s review a whole process of a tcp segment sending and receiving, the connection is initiated with 3 segments, then established, and shut down with 4 segments(normally). For each endpoint, as the tcp segment’s sending and receiving, the state is changing. I presume there’s no exception during the communication, and the change will be as following,</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState2.png" alt="TCP two endpoints state transmission"><figcaption>TCP two endpoints state transmission</figcaption>
</figure>
<p>TCP服务端和客户端初始状态都是CLOSED状态。服务端调用函数Accept()后，由CLOSED状态迁移到LISTEN状态，服务端等待客户端连接请求SYN到达。客户端发出[1.SYN]请求连接，客户端状态有CLOSED状态迁移到SYN_SENT状态，客户端在此状态等待三次握手结束。服务端收到[1.SYN]后，立即由LISTEN状态迁移到SYN_RECEIVED状态，发出第二次握手的数据[2.SYN，ACK]。服务端继续等待第三次握手数据[3.ACK]。客户发送第三次握手数据[3.ACK]，进入ESTABLISHED状态，服务端收到[3.ACK]后进入ESTABLISHED状态，连接建立，双端开始收发数据。客户端首先发起断开连接[8.FIN]请求（也可由服务端发起），此请求发出后客户端状态也随之迁移到FIN_WAIT_1状态，等待着对端确认[8.FIN]。服务端收到[8.FIN]后，得知客户端已经没有更多数据发送，服务端回复[9.ACK]，并迁移到CLOSE_WAIT状态，继续等待将本端应用层数据发往客户端。而客户端从服务端收到[9.ACK]时，客户端由FIN_WAIT_1状态迁移到FIN_WAIT_2状态，在FIN_WAIT_2状态中，客户端只接收服务端的数据，不发送数据，直到服务端发来FIN明确通知客户端没有更多数据发送。服务端一旦发出最后一个[10.FIN]，服务端便迁移到LAST_ACK状态以等待客户端对[10.FIN]确认。客户端确认后，进入TIME_WAIT状态，以防这个确认[11.ACK]丢失。收到确认后，服务端直接迁移到CLOSED状态。TIME_WAIT状态超时后，客户端进入CLOSED状态。</p>
<p>由于两端的状态变化互相关联，所以可以将二者合并，得到RFC793里所描述的状态迁移图的雏形。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState3.png" alt="TCP双端正常通信状态迁移图"><figcaption>TCP双端正常通信状态迁移图</figcaption>
</figure>
<p>#TCP双端异常通信状态迁移</p>
<p>异常TCP通信主要是指存在RST分段数据参与的TCP通信，比如客户端主动连接服务器端口遇到服务器没有进程监听对应端口，服务器回复RST分段拒绝客户端的连接请求。RST分段会导致TCP端直接迁移到CLOSED状态，如果服务端循环调用函数Accept()，也可以认为服务端迁移到LISTEN状态。下图增加了两个异常状态的迁移作为例子。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState4.png" alt="TCP双端异常通信状态迁移"><figcaption>TCP双端异常通信状态迁移</figcaption>
</figure>
<p>#TCP双端同时建立连接状态迁移</p>
<p>当两个进程同时建立TCP连接时，连接建立过程与客户端和服务端建立连接的三次握手不同。同时建立连接过程的时序如下，这里不区分客户端和服务端。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState5.png" alt="连接同时建立时序"><figcaption>连接同时建立时序</figcaption>
</figure>
<p>根据同时建立连接的时序，来完善状态迁移图。由于两端的状态迁移相同，合并后的结果如下。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState6.png" alt="连接同时建立状态迁移"><figcaption>连接同时建立状态迁移</figcaption>
</figure>
<p>#TCP双端同时断开连接状态迁移</p>
<p>同时断开双向通信管道仍然需要四次挥手。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState7.png" alt="当FIN和ACK分别发送时的时序"><figcaption>当FIN和ACK分别发送时的时序</figcaption>
</figure>
<p>FIN段和ACK段经常可能会绑定在一起发送，所以同时断开连接时的状态迁移过程中在这种情况下不经历CLOSING状态而直接进入TIME_WAIT。</p>
<figure>
<img src="/2016-01-23-tcp-connection-status-transit/TCPState8.png" alt="当FIN和ACK绑定发送时的时序"><figcaption>当FIN和ACK绑定发送时的时序</figcaption>
</figure>
<p>合并有CLOSING状态和没有CLOSING状态的两种情况。 <img src="/2016-01-23-tcp-connection-status-transit/TCPState9.png" alt="同时关闭状态迁移"></p>
<p>#TCP完整状态迁移图 将以上叙述的全部状态迁移整理合并，得到RFC793的状态迁移图，分解整理状态迁移的过程，更加有利于对于此状态迁移图中每个细节的深入理解。 <img src="/2016-01-23-tcp-connection-status-transit/TCPState10.png" alt="图22，完整的TCP状态迁移图"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Network-protocal-TCP/" rel="tag"># Network protocal, TCP</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016-01-16-linux-zombieprocess/" rel="next" title="LINUX僵尸进程">
                <i class="fa fa-chevron-left"></i> LINUX僵尸进程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016-01-31-tcp-timewait-status/" rel="prev" title="TIME_WAIT state">
                TIME_WAIT state <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/logo.jpg"
                alt="toto" />
            
              <p class="site-author-name" itemprop="name">toto</p>
              <p class="site-description motion-element" itemprop="description">About Math, About CS.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:toto.zhang@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="skype:tao.zhang@ericsson.com?call|chat" target="_blank" title="Skype">
                      
                        <i class="fa fa-fw fa-skype"></i>Skype</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#state-transmission-chart"><span class="nav-number">1.</span> <span class="nav-text">State transmission chart</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">toto.zhang@gmail.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
