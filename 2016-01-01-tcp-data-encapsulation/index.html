<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Back To The Basics" type="application/atom+xml" />






<meta name="description" content="When computers performs network communication, it’s essentially inter-process communication across operating systems. When communicating between processes within the same operating system, the process">
<meta property="og:type" content="article">
<meta property="og:title" content="TCP Data Encapsulation">
<meta property="og:url" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/index.html">
<meta property="og:site_name" content="Back To The Basics">
<meta property="og:description" content="When computers performs network communication, it’s essentially inter-process communication across operating systems. When communicating between processes within the same operating system, the process">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack1.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack2.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack3.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack4.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack5.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack6.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack7.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack8.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack9.png">
<meta property="og:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack10.png">
<meta property="og:updated_time" content="2018-12-18T10:24:18.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TCP Data Encapsulation">
<meta name="twitter:description" content="When computers performs network communication, it’s essentially inter-process communication across operating systems. When communicating between processes within the same operating system, the process">
<meta name="twitter:image" content="http://taotao.guru/2016-01-01-tcp-data-encapsulation/TCPStack1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://taotao.guru/2016-01-01-tcp-data-encapsulation/"/>





  <title>TCP Data Encapsulation | Back To The Basics</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Back To The Basics</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Trivialities on mathematics and computer science.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://taotao.guru/2016-01-01-tcp-data-encapsulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="toto">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Back To The Basics">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">TCP Data Encapsulation</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-01T20:38:55+08:00">
                2016-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>When computers performs network communication, it’s essentially inter-process communication across operating systems. When communicating between processes within the same operating system, the process exchanges data through pipes, FIFOs, shared memory, etc<a href="https://www.ibm.com/developerworks/cn/linux/l-ipc/" target="_blank" rel="noopener">{1}</a>. The data itself does not change. In network communication, because the operating system is spanned, the process needs to help locate the remote process by using the network layer and transport layer module provided by the operating system. This article briefly describes the data (encapsulation layer) of the interprocess communication when it interacts across the TCP/IP network protocol stack, data encapsulation, transmission and decapsulation. <a id="more"></a></p>
<h2 id="a-typical-tcpip-network">A Typical TCP/IP Network</h2>
<p>The two Ethernet switches form two Ethernet LAN segments (LAN A and LAN B), where the network segment LAN A is 10.22.5.0/24 and the network segment LAN B is 10.16.56.0/24. Segments are connected by a router to form an internet. <img src="/2016-01-01-tcp-data-encapsulation/TCPStack1.png"></p>
<p>Use VirtualBox and GNS3 to build this topology, involving the operating system and software,</p>
<ul>
<li>Host A in network A: Ubuntu14.04</li>
<li>Host B in Network B: Ubuntu 12.04 (running in Virtualbox)</li>
<li>Router Router OS: Cisco 2600 (running on GNS3)</li>
</ul>
<h2 id="tcpip-protocol-stacks">TCP/IP protocol stacks</h2>
<p>The TCP/IP nprotocol stack is the most widely applied protocols in the network area (Figure 2). In this protocol stack, each layer corresponds to the software associated with this layer. The “application layer” represents the user process and the related protocols that it complies with. For example, when browsing a webpage using a browser, the browser process communicates with the remote web server process, both of which comply with the HTTP protocol, the browser sends the request, and the server sends back the responses. The “transport layer” represents the software modules implemented in the operating system kernel (sometimes not in OS kernel) such as TCP module, UDP module and the protocols it complies with. The transport layer provides services for the upper layer. For example, the application layer needs data not to be lost during transmission, and not duplicated, the application layer needs to reference the TCP protocol to send and receive data. The “network layer” is used to find the destination host for the packets and route the data to the destination host. The “data link layer” performs the actual transceiving operation of the data. Data encapsulation is performed in this protocol stack structure. (In fact, the implementation of the transport layer is not necessarily limited to the system kernel. At present, most operating system implementations implement the transport layer protocol in the kernel.) <img src="/2016-01-01-tcp-data-encapsulation/TCPStack2.png"></p>
<h2 id="data-from-user-processes-application-layer-messages">Data from user processes, application layer messages</h2>
<p>The application layer protocol is the protocol used for interprocess communication in the internetwork. It is mainly used for two processes or multiple processes in the network to send data back and forth. The data sent at this layer, we call them messages, the message sent between processes, generated by the process developer according to the application layer protocol it refers to, such as HTTP messages, LDAP messages, etc. In order to clearly explain the problem, we temporarily set aside complex and existing application layer protocols to design a minimalist new application layer protocol. The protocol is as follows:</p>
<ul>
<li>In an internet.</li>
<li>Server：Server process running on host S.</li>
<li>CLient: Client process running on host C.</li>
<li>Client sends a string “request,hostname”, which is ask for the hostname of the server.</li>
<li>After the server receives the message, the server get the hostname of itself, and response a string “response, [the real hostname]”。</li>
</ul>
<p>According to the actual situation of modern multi-task operating system, this process can be shown as follows: <img src="/2016-01-01-tcp-data-encapsulation/TCPStack3.png"></p>
<p>In TCP/IP networks, the process Client provides the Client OS with information about the process Server (IP address, TCP service port number). Process Server also notifies its operating system, Server OS, on which TCP port it is listening for connection requests. The above content is what application developers and application layer protocol stakeholders (such as network technical support, black hat, white hat packet analysis, etc.) need to pay attention to.</p>
<h2 id="encapsulation-of-application-layer-messages">Encapsulation of application-layer messages</h2>
<p>The request message “request,hostname” initiated by the process “Client” will not be sent to the receiver process “Server” arbitraily. It has to go through the network topology showen in figure 1 to the Server process with the help of the operating system. The details of “message” itself does not provide enough information to the client operating system to locate the remote host in the network, or even the process Server running in the remote host.Therefore, the Client process needs to provide this information to the operating system, and the operating system will append this information to the application layer message data. This process of information appending is called “data encapsulation”.In order to focus on “data encapsulation”, details such as segmentation of the transport layer will not be explained here, and these details will be specifically explained in subsequent articles.</p>
<p>根据TCP/IP网络协议栈结构，应用层消息“request,hostname”，首先来到操作系统内核（OS Kernel）中的TCP传输层处理模块。TCP处理模块为消息添加__源端口号（source port）__以标识数据自ClientOS的哪个进程发出，这个端口号由操作系统负责临时分配。另外，它还为消息添加了__目的端口号（destination port）__以标识消息送往对端的哪一个接收进程，这个端口号由Client进程通知操作系统内核，大多数情况使用所谓“众所周知的端口号（Well-Known Port）”，当然端口号的选择并不是限定死的，如本例中Client进程使用的目标端口为1982，或者也可以使用80端口开FTP服务。</p>
<p>接下来，TCP模块为消息添加了一些重要的附加字段，也就是在“图4”中我标识了“misc”的部分，这部分是TCP协议区别于其他传输层协议的一些核心功能数据字段（如UDP，SCTP等）。至此，传输层对应用层消息封装结束，经过传输层封装后的数据，我们一般称为“段”（segment）。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack4.png"></p>
<p>其中Misc部分的详细内容就是TCP的消息头结构中的一部分，细节此处暂时不予说明，后续文章中会专门对这些细节进行说明。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack5.png"></p>
<p>以上内容是传输层协议开发者需要关注的内容，协议为上层提供哪些服务，比如保证应用层数据不丢失的传送出去，或者尽量快速的传送出去都是这层开发者需要关注的内容。</p>
<h2 id="操作系统网络层对数据的封装">操作系统网络层对数据的封装</h2>
<p>TCP封装完的段数据来到了网络层。前边提到，网络层的主要作用是主机寻址与路由（Routing），这层的协议也就是在复杂互联网络中找到对端主机的一层协议。既然协议的目的是在网络中寻找主机，那就一定需要接收端主机目的地址，而数据从对端返回时，也需要发送端主机的源地址。也就是目的IP和源IP（IPv4或IPv6皆可，我以IPv4举例）。</p>
<p>接收端主机的IP地址需要由应用层进程Client提供，因为只有Client进程知道自己所发送的数据要去往哪个主机。此处还有一个问题，客户端主机的源地址怎么确定呢？现在大部分计算机都有多个网络适配器，同时接入到多个网络（Multi-Homed），比如WIFI模块，物理网线接口，SIM卡WAN接口，VPN接口，虚拟网卡等等。每一类接口都对应会有一个IP地址。选择哪个IP地址作为源地址呢？</p>
<p>这是拓扑图中的主机C配置内容， <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 08:00:27:ff:66:a4</span><br><span class="line">          inet addr:10.16.56.2  Bcast:10.16.56.255  Mask:255.255.255.0</span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">wlan0     Link encap:Ethernet  HWaddr 84:3a:4b:1d:c0:c0  </span><br><span class="line">          inet addr:192.168.1.104  Bcast:192.168.1.255  Mask:255.255.255.0</span><br><span class="line">wwan0     Link encap:Ethernet  HWaddr 4a:b6:38:ec:5c:6d  </span><br><span class="line">          inet addr:10.18.150.41  Bcast:10.18.150.47  Mask:255.255.255.248</span><br></pre></td></tr></table></figure></p>
<p>实际上，内核中的IP处理模块，需要参考接收端IP地址来决定选择使用哪一个发送端IP地址。应用进程Client发送数据的目的地为主机S，其IP地址为10.22.5.3，IP处理模块此时需要查看本机路由表，以确认从哪个网络适配器发送数据，从而进一步进行数据的打包封装。进程Client所在主机C的内核路由表如下，参考目的IP地址10.22.5.3，所以需要选择默认路由从eth0发出数据，最终源地址应该选择eth0网络适配器的地址10.16.56.2，此处也解释了为什么主机需要路由表这个问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ route -nv</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.16.56.1      0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">10.16.56.0      0.0.0.0         255.255.255.0   U     1      0        0 eth0</span><br><span class="line">10.18.150.40    0.0.0.0         255.255.255.248 U     5      0        0 wwan0</span><br><span class="line">192.168.1.0     0.0.0.0         255.255.255.0   U     9      0        0 wlan0</span><br></pre></td></tr></table></figure>
<p>确定了源主机IP地址和目的主机IP地址之后，网络层开始对来自传输层的段数据（segment）进行封装。IP层封装之后的段数据，称为IP数据包（IP Packet）。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack6.png"></p>
<p>到此为止，数据在操作系统内核阶段的打包封装就完成了。</p>
<h2 id="数据包离开主机进入网络">数据包离开主机，进入网络</h2>
<p>现在IP数据包就可以向外发送了。如同发送快递时需要快递员将货物包裹携带到下一站，发送IP包时，我们还需要链路层（包括物理层）的帮助将IP包携带到下一个路由器中转。IP包从一个含有IP处理软件模块的主机到另一个含有IP软件处理模块的主机的过程，称为IP包经过了一跳（Hop）。IP包经过这样一跳一跳的最终到达目的地。这里以“图1”的以太网拓扑为例，主机C发出的数据包到主机S的出口为网络适配器eth0，所以增加eth0的MAC地址作为源MAC地址，通过ARP协议获得路由器的目的MAC地址，根据获得的MAC地址将数据发出到下一跳。</p>
<p>ARP协议相当于网络适配器主机C在自己所在的子网中发送广播询问，“网络中的哪一台主机IP地址是10.16.56.1，请提供MAC地址到08:00:27:ff:66:a4”。获取MAC地址后，就会将目的MAC地址保存在内核的ARP缓存列表，之后将IP包发送给路由器。这里不必每次使用ARP协议进行询问目的MAC地址，而是_周期性进行更新_。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack7.png"></p>
<p>获得目的MAC地址以后，链路层软件继续对来自网络层的数据进行封装，经过链路层封装以后的数据，一般称为“帧”（Frame）。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack8.png"> 此时帧数据可以送到物理网卡发出了，物理网卡通过网线将这个数据帧以高低电平的形式（1001010101010…）发送出去。这个数据帧首先到达网络中的交换机（Switch），交换机在ARP请求目的MAC地址的时候，已经记录了源MAC地址和目的MAC地址对应自己的哪两个物理端口。使用物理层的光或电信号，交换机根据目的MAC地址将这个数据帧发送到路由器。</p>
<h2 id="数据包去向何方路由器登场">数据包去向何方，路由器登场</h2>
<p>数据帧到达路由器后，路由器首先去掉所有链路层的地址信息，然后读取IP层的目的IP地址，并且使用目的IP地址对照自己的路由表，来分析这个网络封包要去往自己的哪一个接口所连接的网络，路由器重复链路层的处理，根据所连数据链路的类型，重新给IP包安装数据链路层的地址，路由器在重新封装IP包为链路层数据帧之前，同样使用ARP请求来获取下一跳的链路层MAC地址，数据前往下一跳。最终到达目的主机。 <img src="/2016-01-01-tcp-data-encapsulation/TCPStack9.png"></p>
<p>如果数据包经过多个路由器，处理过程也是一样，区别不过在于路由器的路由表更新方式和IP包跳数的变化而已。以上部分就是路由器厂商关注的内容，比如Cisco，爱立信，华为等等，还有IP认证学习的内容，包括CCIE，CCNP，CCNA认证之流。当然也有不要脸的厂商偷偷的窃取用户的数据，一般也在这里悄悄完成。</p>
<h2 id="数据包到达目的主机解封装">数据包到达目的主机，解封装</h2>
<p>到达目的主机后，数据开始进行解封装（Decapsulation）， - 目标主机的链路层去掉链路层的相关字段，根据类型字段将数据发往IP层处理模块。 - IP层去掉网络层相关字段，根据类型字段将数据发往TCP处理模块。 - TCP层获得段数据，去掉本层的字段，根据目的端口号，将应用消息数据发往对应的进程Server。 - 最终，Server进程获取到“图3”中的数据“request,hostname”。 - 在整个的封装过程与解封装过程中，我省略了数据的校验过程，实际上，数据校验过程发生在各层处理过程中。</p>
<p><img src="/2016-01-01-tcp-data-encapsulation/TCPStack10.png"></p>
<p>当服务进程Server获取自己的主机名称，对Client进程进行响应时，Server重复上述封装，发送，解封装的过程将数据返回到Client进程。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015-12-24-network-topology-in-virtualbox/" rel="next" title="VirtualBox Network Topology">
                <i class="fa fa-chevron-left"></i> VirtualBox Network Topology
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016-01-02-tcp-comminication-model/" rel="prev" title="TCP/IP网络通信模型">
                TCP/IP网络通信模型 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/logo.jpg"
                alt="toto" />
            
              <p class="site-author-name" itemprop="name">toto</p>
              <p class="site-description motion-element" itemprop="description">About Math, About CS.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:toto.zhang@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="skype:tao.zhang@ericsson.com?call|chat" target="_blank" title="Skype">
                      
                        <i class="fa fa-fw fa-skype"></i>Skype</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#a-typical-tcpip-network"><span class="nav-number">1.</span> <span class="nav-text">A Typical TCP/IP Network</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tcpip-protocol-stacks"><span class="nav-number">2.</span> <span class="nav-text">TCP/IP protocol stacks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-from-user-processes-application-layer-messages"><span class="nav-number">3.</span> <span class="nav-text">Data from user processes, application layer messages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#encapsulation-of-application-layer-messages"><span class="nav-number">4.</span> <span class="nav-text">Encapsulation of application-layer messages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#操作系统网络层对数据的封装"><span class="nav-number">5.</span> <span class="nav-text">操作系统网络层对数据的封装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据包离开主机进入网络"><span class="nav-number">6.</span> <span class="nav-text">数据包离开主机，进入网络</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据包去向何方路由器登场"><span class="nav-number">7.</span> <span class="nav-text">数据包去向何方，路由器登场</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据包到达目的主机解封装"><span class="nav-number">8.</span> <span class="nav-text">数据包到达目的主机，解封装</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">toto.zhang@gmail.com</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
